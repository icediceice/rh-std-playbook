#!/bin/bash
# Configuration Backup Script for {{ server_hostname }}

BACKUP_DIR="/var/backups/configs"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/config-backup-$DATE.tar.gz"

# Create backup directory
mkdir -p $BACKUP_DIR

# List of configuration files/directories to backup
CONFIGS=(
    /etc/hostname
    /etc/hosts
    /etc/chrony.conf
    /etc/rsyslog.conf
    /etc/firewalld/
    /etc/selinux/config
    /etc/systemd/system/
    /etc/cron.d/
    /etc/crontab
    {% if install_container_tools | default(false) %}
    /etc/containers/
    {% endif %}
)

# Create backup
tar -czf $BACKUP_FILE ${CONFIGS[@]} 2>/dev/null

# Remove old backups (keep last 30 days)
find $BACKUP_DIR -name "config-backup-*.tar.gz" -mtime +30 -delete

echo "Configuration backup completed: $BACKUP_FILE"